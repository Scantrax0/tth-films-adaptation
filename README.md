# tth-films-adaptation

Проект доступен по ссылке: http://91.185.84.89:9000/

Проект анализирует видео на наличие фрагментов, которые могут привести к возникновению эпилептических приступов. В случае обнаружения фрагменты выделяются в соответствующие структуры данных - списки векторов, указывающие на начало и конец фрагмента (для кадров и временных отметок). Соответствующие вектора можно использовать по-разному: выполнять предобработку видеоматериалов перед их конечной загрузкой на сервера или, например, уменьшать яркость и/или "блюрить" фрагменты во время проигрывания. Дополнительно реализованы фильтры цветокоррекции.

## Алгоритм поиска опасных фрагментов

Для каждого кадра алгоритм вычисляет "воспринимаемую яркость кадра":
```
mean_brightness = math.sqrt(0.241*(r**2) + 0.691*(g**2) + 0.068*(b**2))
```
, где **r**, **g** и **b** - относительные яркости соответствующих каналов.

Затем в данном наборе выявляются пиковые значения по алгоритму [Janko Slavic findpeaks]("https://github.com/jankoslavic/py-tools/blob/master/findpeaks/findpeaks.py"). Каждый пик анализируется влево и вправо на расстояние до нескольких **framerate** (кол-ва кадров в секунду соответствующего видео). Если в данных промежутках обнаруживаются существенные снижения воспринимаемой яркости, то промежуток добавляется в ряд "опасных".

## Фильтры цветокоррекции

Проблемы восприятия цвета удобно решать с помощью фильтров цветокоррекции. Для демонстрации работы были разработаны 4 фильтра, доступные в интерфейсе веб приложения.

## Демонстрация

Для демонстрации работы реализовано web приложение на Django, содержащее страницы тестовых видео. Видео (ссылки на youtube) можно добавлять через админ-панель. После добавления запускается фоновая задача на обработку. После обработки страница с видео становится доступной для всех, содержит фильтры, плеер и график, на котором отражены:

* уровень воспринимаемой яркости;
* уровень относительных яркостей для каналов **r**, **g** и **b**;
* опасные участки.

![Интерфейс страницы с видео](https://i.ibb.co/1TvTYNv/image.png)

## Технологии

* asgiref==3.6.0
* Django==4.1.7
* django4-background-tasks==1.2.7
* numpy==1.24.2
* opencv-python==4.7.0.72
* six==1.16.0
* sqlparse==0.4.3
* tzdata==2023.2
* vidgear==0.3.0
* yt-dlp==2023.3.4

## Установка

Установить необходимые пакеты:
```
pip install -r requirements.txt
```
Для Linux требуется библиотека lib.gl1. На Cent OS устанавливается так:
```
yum install mesa-libGL
```
Далее необходимо провести миграции:
```
python manage.py makemigrations
python manage.py migrate
```
Создать суперюзера, который будет использоваться для входа в панель администратора:
```
python manage.py createsuperuser
```

## Запуск

Для запуска приложения нужно запустить два процесса - сервер и очередь задач.

Запуск сервера
```
python manage.py runserver
```
Запуск контроллера очереди задач
```
python manage.py process_tasks
```

## Авторы

*Digital Ninjas*
